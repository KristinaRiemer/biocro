---
title: "Intro Vignette"
author: "Kristina Riemer"
output: pdf_document
---

TODO: 
* all plots in ggplot
* add levels (leaf, canopy, season) and that they're integrated
* simplify parameter estimation

## Purpose of BioCro model

Uses weather/other inputs to simulate growth and photosynthesis (respiration?) of plants. 

## Installing BioCro package

Run below to install the current stable release of BioCro. 

```{r, eval=FALSE}
devtools::install_github('ebimodeling/biocro')
```

```{r}
library(BioCro)
```

## Estimating biomass for growing season

The function `BioGro` is used for this. The only required input is a year of hourly weather data. Here we're using such weather data from a site in Illinois. 

This returns a list where each element is a variable resulting from the model run. This includes biomass values for different parts of the plants and leaf traits such as stomatal conductance and maximum carboxylation rate. 

```{r}
data(cmi04)
head(cmi04)
cmi04_results <- BioGro(cmi04)
names(cmi04_results)
head(cmi04_results$Stem)
```

These results can be visualized using `plot`, which is a modified version of `xyplot` from the `lattice` R package. The default plots the dry biomass of the different plant parts, and other results can be plotted by specifying the `plot.kind`. The cumulative evapotranspiration plot is shown as an example. 

```{r}
plot(cmi04_results)
plot(cmi04_results, plot.kind = "cumET")
```

Many other model parameters can be specified. For example, information about soil properties can be added. The model outputs are plotted for low and high values for the effect of water stress on leaf growth. There is not a built-in way to plot 

```{r}
low_phi <- soilParms(FieldC = 0.37, WiltP = 0.2, phi2 = 1)
high_phi <- soilParms(FieldC = 0.37, WiltP = 0.2, phi2 = 4)

cmi04_results_lowphi <- BioGro(cmi04, soilControl = low_phi)
cmi04_results_highphi <- BioGro(cmi04, soilControl = high_phi)

plot(cmi04_results_lowphi, plot.kind = "SW")
plot(cmi04_results_highphi, plot.kind = "SW")
```

`BioGro` is built on the `c4photo`/`c3photo` and `CanA` functions. Their use is illustrated below. 

## First component: leaf-level photosynthesis

-Required parameters vs optional parameters

This function, `c4photo`, is for estimating photosynthesis from photosynthetically active radiation, temperature, and relative humidity. It returns values for stomatal conductance, net assimilation, intercellular CO2, and gross assimilation. 

```{r}
c4photo(Qp = 1500, Tl = 25, RH = 0.7)

# TODO: add plot of net assimilation where RH varies
```

Others parameters it can take include maximum carboxylation of Rubsicso, quantum efficiency, the Collatz model K, theta, and beta, dark respiration, atmospheric CO2, and the two Ball-Berry model parameters. The function has default values for these. It can also accomodate upper and lower temperature bounds. See the function's help page for more info.  

```{r}
?c4photo()
```

getting priors (Vcmax, quantum efficiency, dark respiration)
```{r}
data(aq)
head(aq)
plotAQ(aq, type = "p")
```

single curve
```{r}
curve1 <- subset(aq, ID == 1)
op <- Opc4photo(curve1[,3:6])
op
```

multiple curves at once
```{r}
aq2 <- data.frame(aq[,-2], Catm=390)
mop <- mOpc4photo(aq2, verbose=TRUE)
mop
```

optimize rd or all three with `op.level`

bayesian approach for priors (Vcmax and quantum efficieny only)

```{r}
op.mc1 <- MCMCc4photo(curve1[,3:6], scale=1.5)
op.mc2 <- MCMCc4photo(curve1[,3:6], scale=1.5)
op.mc1
plot(op.mc1, op.mc2, plot.kind="density", burnin=1e4)
```

## Second component: canopy photosynthesis and transpiration

TODO: how is this canopy stuff related to above leaf-level simulations? 

uses `CanA` 
simulates CO2 assimilation (PS) of canopy

```{r}
nlay <- 8
res <- CanA(lai=3, doy=200, hr=12, solar=1500, temp=25, rh=0.7,
            windspeed=2, nlayers=nlay)
```

also transpiration of canopy
should be second three values returned from `CanA`, but returns nothing

